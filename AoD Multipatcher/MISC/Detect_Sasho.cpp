#include "stdafx.h"


void Detect_Sasho(int &Version, bool &Sasho)
{
	size_t Position;
	string Original = "Compiled on";				// Questa stringa è presente solo negli EXE originali ed è assente in quelli di Sasho
	if ((Position = EXEorig.find(Original)) != std::string::npos)	// Se trova la stringa allora il file è originale Core Design
		Sasho = false;
	else											// Se la stringa è assente allora attiva il flag "Sasho" ed aggiorna il numero di versione (necessario per v55)
	{
		Sasho = true;
		
		// La stringa "Sasho_version" serve a leggere v52 o v55 da un punto diverso del file rispetto a "Detect_version"
		// 42656E63 686D6172 6B000000 3D3D3D3D 3D3D3D3D  Benchmark...========
		// 3D                                            =
		string Sasho_version("\x42\x65\x6E\x63\x68\x6D\x61\x72\x6B\0\0\0\x3D\x3D\x3D\x3D\x3D\x3D\x3D\x3D\x3D", 21);

		if ((Position = EXEorig.find(Sasho_version)) != std::string::npos)      // Questo "if" è teoricamente sempre vero nelle versioni di Sasho
		{
			string temp(1, EXEorig.at(Position-4));
			temp.append(1, EXEorig.at(Position-3));
			Version = stoi(temp);                       // Converte la stringa di 2 caratteri in un intero (Version)
		}
	}
}


int Detect_Sasho_advanced()
{
	size_t Position1, Position2, Position3;

	/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
	///////////////////////////////////////////////////		STRINGHE DI IDENTIFICAZIONE VERSIONE SASHO  	/////////////////////////////////////////////////////////

	// Stringhe principali
	string sasho_200("\xEB\x0E\xE9\x08\x03\0\0\xE9\xF2\x07\0\0\0\0\0\0\x56\x55\x53\x83\xEC\x10\x8B\x74\x24\x20\xFF\x35\xB4\xA3\x7F\0\x8B\xAE\x50\x01\0\0\x8B\x46\x48\xFF\xB0\x78\x01\0\0\xE8\x10\xE9\xAC\xFF\xDD\x5C\x24\x10\x83\xC4\x08\x8B\x44\x24\x28\xBB\0\x01\0\0\x85\xC0\x74\x1D\x8B\x44\x24\x24\xFF\x70\x04\xE8\x48\x14\xB8\xFF\x59\x83\xE0\x03\xBB\0\x01\0\0\xB8\xC0\x05", 96);
	string sasho_300("\xEB\x1D\xE9\x2E\x03\0\0\xE9\x22\x08\0\0\xE9\x63\x08\0\0\xE9\xB8\x08\0\0\xE9\x04\x0A\0\0\0\0\0\0\x56\x55\x53\x83\xEC\x10\x8B\x74\x24\x20\xFF\x35\xB4\xA3\x7F\0\x8B\xAE\x50\x01\0\0\x8B\x46\x48\xFF\xB0\x78\x01\0\0\xE8\x01\xE9\xAC\xFF\xDD\x5C\x24\x10\x83\xC4\x08\x8B\x44\x24\x28\xBB\0\x01\0\0\x85\xC0\x74\x1D\x8B\x44\x24\x24\xFF\x70\x04\xE8\x39", 96);
	string sasho_400("\xEB\x1E\xE9\xC3\x03\0\0\xE9\xC1\x08\0\0\xE9\x02\x09\0\0\xE9\x57\x09\0\0\xE9\xA8\x0A\0\0\xE9\xF5\x0A\0\0\x56\x55\x53\x83\xEC\x10\x8B\x74\x24\x20\xFF\x35\xB4\xA3\x7F\0\x8B\xAE\x50\x01\0\0\x8B\x46\x48\xFF\xB0\x78\x01\0\0\xE8\0\xE9\xAC\xFF\xDD\x5C\x24\x10\x83\xC4\x08\x8B\x44\x24\x28\xBB\0\x01\0\0\x83\xF8\x01\x75\x1D\x8B\x44\x24\x24\xFF\x70\x04", 96);
	string sasho_410("\xEB\x1E\xE9\xCE\x03\0\0\xE9\xCC\x08\0\0\xE9\x0D\x09\0\0\xE9\x62\x09\0\0\xE9\xAE\x0A\0\0\xE9\xFB\x0A\0\0\x56\x55\x53\x83\xEC\x10\x8B\x74\x24\x20\xFF\x35\xB4\xA3\x7F\0\x8B\xAE\x50\x01\0\0\x8B\x46\x48\xFF\xB0\x78\x01\0\0\xE8\0\xE9\xAC\xFF\xDD\x5C\x24\x10\x83\xC4\x08\x8B\x44\x24\x28\xBB\0\x01\0\0\x83\xF8\x01\x75\x1D\x8B\x44\x24\x24\xFF\x70\x04", 96);
	string sasho_500("\xEB\x23\xE9\xAD\x03\0\0\xE9\x70\x08\0\0\xE9\xB1\x08\0\0\xE9\x06\x09\0\0\xE9\x52\x0A\0\0\xE9\x9F\x0A\0\0\xE9\xF7\x0E\0\0\x56\x55\x53\x83\xEC\x10\x8B\x74\x24\x20\xFF\x35\xB4\xA3\x7F\0\x8B\xAE\x50\x01\0\0\x8B\x46\x48\xFF\xB0\x78\x01\0\0\xE8\xFB\xE8\xAC\xFF\xDD\x5C\x24\x10\x83\xC4\x08\x8B\x44\x24\x28\xBB\0\x01\0\0\x83\xF8\x01\x75\x1D\x8B\x44", 96);
	string sasho_600("\xEB\x55\xE9\xBD\0\0\0\xE9\x94\x05\0\0\xE9\xD5\x05\0\0\xE9\x2A\x06\0\0\xE9\x70\x07\0\0\xE9\xF5\x07\0\0\xE9\x33\x0C\0\0\xE9\x6A\x0C\0\0\xE9\x1E\x14\0\0\xE9\x64\x14\0\0\xE9\xB1\x14\0\0\0\0\0\0\0\0\x34\x42\0\0\0\0\0\0\0\0\x48\x42\0\0\xF0\x41\0\0\x0C\x42\0\0\x70\x41\x8B\x74\x24\x04\x8B\x86\x50\x01\0", 96);
	string sasho_610("\xEB\x55\xE9\xBD\0\0\0\xE9\x98\x05\0\0\xE9\xD9\x05\0\0\xE9\x2E\x06\0\0\xE9\x74\x07\0\0\xE9\xF9\x07\0\0\xE9\x3B\x0C\0\0\xE9\x72\x0C\0\0\xE9\x2A\x14\0\0\xE9\x70\x14\0\0\xE9\xBD\x14\0\0\0\0\0\0\0\0\x34\x42\0\0\0\0\0\0\0\0\x48\x42\0\0\xF0\x41\0\0\x0C\x42\0\0\x70\x41\x8B\x74\x24\x04\x8B\x86\x50\x01\0", 96);
	string sasho_620("\xE9\x59\0\0\0\xE9\x13\x01\0\0\xE9\xFF\x05\0\0\xE9\xEC\xBF\x63\xFF\xE9\x3B\x06\0\0\xE9\x81\x07\0\0\xE9\x06\x08\0\0\xE9\x48\x0C\0\0\xE9\x7F\x0C\0\0\xE9\x37\x14\0\0\xE9\x7D\x14\0\0\xE9\xCA\x14\0\0\xE9\xBC\x15\0\0\0\0\0\0\0\0\0\0\0\0\0\x48\x42\0\0\xF0\x41\0\0\x0C\x42\0\0\x70\x41\0\0\0\0\x53\x6A", 96);
	string sasho_621("\xE9\x59\0\0\0\xE9\x13\x01\0\0\xE9\xFF\x05\0\0\xE9\xEC\xBF\x63\xFF\xE9\x3B\x06\0\0\xE9\x81\x07\0\0\xE9\x06\x08\0\0\xE9\x48\x0C\0\0\xE9\x7F\x0C\0\0\xE9\x37\x14\0\0\xE9\x7D\x14\0\0\xE9\xCA\x14\0\0\xE9\x1C\x16\0\0\0\0\0\0\0\0\0\0\0\0\0\x48\x42\0\0\xF0\x41\0\0\x0C\x42\0\0\x70\x41\0\0\0\0\x53\x6A", 96);
	string sasho_630("\xE9\x5E\0\0\0\xE9\x18\x01\0\0\xE9\x0F\x06\0\0\xE9\xEC\xBF\x63\xFF\xE9\x4B\x06\0\0\xE9\x91\x07\0\0\xE9\x16\x08\0\0\xE9\x5F\x0C\0\0\xE9\x96\x0C\0\0\xE9\x4E\x14\0\0\xE9\x94\x14\0\0\xE9\xE1\x14\0\0\xE9\x33\x16\0\0\xE9\xED\x16\0\0\0\0\0\0\0\0\0\0\0\0\0\x48\x42\0\0\xF0\x41\0\0\x0C\x42\0\0\x70\x41\0", 96);
	string sasho_640_641("\xE9\x70\0\0\0\xE9\x2A\x01\0\0\xE9\x21\x06\0\0\xE9\xEC\xBF\x63\xFF\xE9\x5D\x06\0\0\xE9\xA3\x07\0\0\xE9\x28\x08\0\0\xE9\x71\x0C\0\0\xE9\xA8\x0C\0\0\xE9\x60\x14\0\0\xE9\xA6\x14\0\0\xE9\xF3\x14\0\0\xE9\x45\x16\0\0\xE9\xFF\x16\0\0\xE9\x28\x17\0\0\xE9\x55\x1C\0\0\0\0\0\0\0\0\0\0\0\0\0\x48\x42\0\0\xF0", 96);
	string sasho_642("\xE9\x74\0\0\0\xE9\x2E\x01\0\0\xE9\x36\x06\0\0\xE9\xEC\xBF\x63\xFF\xE9\x72\x06\0\0\xE9\xB8\x07\0\0\xE9\x3D\x08\0\0\xE9\x86\x0C\0\0\xE9\xBD\x0C\0\0\xE9\x75\x14\0\0\xE9\xBB\x14\0\0\xE9\x08\x15\0\0\xE9\x5A\x16\0\0\xE9\x14\x17\0\0\xE9\x3D\x17\0\0\xE9\x6A\x1C\0\0\0\0\0\0\0\0\0\0\0\0\0\x48\x42\0\0\xF0", 96);
	string sasho_643("\xE9\x88\0\0\0\xE9\x6B\x01\0\0\xE9\x66\x06\0\0\xE9\xEC\xBF\x63\xFF\xE9\xBF\x06\0\0\xE9\x05\x08\0\0\xE9\x8A\x08\0\0\xE9\xB3\x0C\0\0\xE9\xEA\x0C\0\0\xE9\x9B\x14\0\0\xE9\xE1\x14\0\0\xE9\x49\x15\0\0\xE9\x9B\x16\0\0\xE9\x55\x17\0\0\xE9\x7E\x17\0\0\xE9\x97\x1C\0\0\xE9\xC8\x1E\0\0\xE9\xF3\x1E\0\0\xE9\xF9\x1E\0\0\0", 96);
	string sasho_650_651("\xE9\x8D\0\0\0\xE9\x70\x01\0\0\xE9\x6B\x06\0\0\xE9\xEC\xBF\x63\xFF\xE9\xC4\x06\0\0\xE9\x0A\x08\0\0\xE9\x8F\x08\0\0\xE9\xB1\x0C\0\0\xE9\xE8\x0C\0\0\xE9\x99\x14\0\0\xE9\xDF\x14\0\0\xE9\x47\x15\0\0\xE9\x99\x16\0\0\xE9\x53\x17\0\0\xE9\x7C\x17\0\0\xE9\x95\x1C\0\0\xE9\xC6\x1E\0\0\xE9\xF1\x1E\0\0\xE9\xF7\x1E\0\0\xE9", 96);
	string sasho_660_661_662("\xE9\xAC\0\0\0\xE9\x8F\x01\0\0\xE9\x70\x06\0\0\xE9\xEC\xBF\x63\xFF\xE9\xC9\x06\0\0\xE9\x4F\x07\0\0\xE9\xD4\x07\0\0\xE9\xF6\x0B\0\0\xE9\x2D\x0C\0\0\xE9\xDE\x13\0\0\xE9\x24\x14\0\0\xE9\x8C\x14\0\0\xE9\xDE\x15\0\0\xE9\x98\x16\0\0\xE9\xC1\x16\0\0\xE9\xDA\x1B\0\0\xE9\x0B\x1E\0\0\xE9\x36\x1E\0\0\xE9\x3C\x1E\0\0\xE9", 96);
	string sasho_663("\xE9\xAC\0\0\0\xE9\x8F\x01\0\0\xE9\x72\x06\0\0\xE9\xEC\xBF\x63\xFF\xE9\xCB\x06\0\0\xE9\x51\x07\0\0\xE9\xD6\x07\0\0\xE9\xF8\x0B\0\0\xE9\x2F\x0C\0\0\xE9\xE0\x13\0\0\xE9\x26\x14\0\0\xE9\x8E\x14\0\0\xE9\xE0\x15\0\0\xE9\x9A\x16\0\0\xE9\xC3\x16\0\0\xE9\xDC\x1B\0\0\xE9\x0D\x1E\0\0\xE9\x38\x1E\0\0\xE9\x3E\x1E\0\0\xE9", 96);
	string sasho_664("\xE9\xAC\0\0\0\xE9\x8F\x01\0\0\xE9\x72\x06\0\0\xE9\xEC\xBF\x63\xFF\xE9\xCD\x06\0\0\xE9\x53\x07\0\0\xE9\xD8\x07\0\0\xE9\xFA\x0B\0\0\xE9\x31\x0C\0\0\xE9\xE2\x13\0\0\xE9\x2A\x14\0\0\xE9\x92\x14\0\0\xE9\xE4\x15\0\0\xE9\x9E\x16\0\0\xE9\xC7\x16\0\0\xE9\xE4\x1B\0\0\xE9\x15\x1E\0\0\xE9\x40\x1E\0\0\xE9\x46\x1E\0\0\xE9", 96);
	
	// Stringhe dirimenti 1
	string sasho_640("\x5D\x5E\xC3\x8B\x45\x34\x85\xC0\x0F\x84\xC9\xFE\xFF\xFF\xC7\x05\x59\x46\x9C\0\0\0\0\0\x68\x93\0\0\0\x68\x84\x3B\x55\0\x6A\x20\x68\x78\x01\0\0\x56\xE8\x55\xED\xB8\xFF\x83\xC4\x14\x83\xC4\x30\x5B\x5D\x5E\xC3\x6A\x31\x68\x88\x38\x55\0", 64);
	string sasho_641("\x5D\x5E\xC3\x8A\x45\x34\xA8\x01\x0F\x84\xC9\xFE\xFF\xFF\xC7\x05\x59\x46\x9C\0\0\0\0\0\x68\x93\0\0\0\x68\x84\x3B\x55\0\x6A\x20\x68\x78\x01\0\0\x56\xE8\x55\xED\xB8\xFF\x83\xC4\x14\x83\xC4\x30\x5B\x5D\x5E\xC3\x6A\x31\x68\x88\x38\x55\0", 64);
	string sasho_650("\x08\xE9\xCB\x03\0\0\x8B\x04\x24\x85\xC0\x0F\x84\xC0\x03\0\0\x57\x6A\x01\xE8\x2F\x68\x04\0\x83\xC4\x08\xE9\xB0\x03\0", 32);
	string sasho_651("\x08\xE9\xCB\x03\0\0\x90\x90\x90\x90\x90\x90\xE9\xC0\x03\0\0\x57\x6A\x01\xE8\x2F\x68\x04\0\x83\xC4\x08\xE9\xB0\x03\0", 32);
	string sasho_660("\x01\0\0\x85\xC0\x0F\x84\xF4\x01\0\0\x8B\xB7\x5C\x01\0\0\x85\xF6\x0F\x84\xE6\x01\0\0\xE8\xBA\xF1\xF7\xFF\xE8\x69", 32);
	string sasho_661_662("\x01\0\0\x85\xC0\x0F\x84\xF4\x01\0\0\x8B\xB7\x5C\x01\0\0\x85\xF6\x90\xE9\xE6\x01\0\0\xE8\xBA\xF1\xF7\xFF\xE8\x69", 32);

	// Stringhe dirimenti 2
	string sasho_661("\x00\x07\x80\x74\x04\x8B\xD6\xEB\x15\x8B\x17\x52\x8B\x02\xFF\x50\x1C\x3D\x1E\0\x07\x80\x74\x0E\x85\xC0\x74\xAC\xEB\x1C\x8B\xC2", 32);
	string sasho_662("\x00\x07\x80\x74\x04\x8B\xD6\xEB\x15\x8B\x17\x52\x8B\x02\xFF\x50\x1C\x3D\x1E\0\x07\x80\x74\x0E\x85\xC0\xEB\x1A\x90\x90\x8B\xC2", 32);

	///////////////////////////////////////////////		FINE STRINGHE DI IDENTIFICAZIONE VERSIONE FILE	 ////////////////////////////////////////////////////////////
	/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////

	if ((Position1 = EXEorig.find(sasho_200)) != std::string::npos)
		return 200;
	if ((Position1 = EXEorig.find(sasho_300)) != std::string::npos)
		return 300;
	if ((Position1 = EXEorig.find(sasho_400)) != std::string::npos)
		return 400;
	if ((Position1 = EXEorig.find(sasho_410)) != std::string::npos)
		return 410;
	if ((Position1 = EXEorig.find(sasho_500)) != std::string::npos)
		return 500;
	if ((Position1 = EXEorig.find(sasho_600)) != std::string::npos)
		return 600;
	if ((Position1 = EXEorig.find(sasho_610)) != std::string::npos)
		return 610;
	if ((Position1 = EXEorig.find(sasho_620)) != std::string::npos)
		return 620;
	if ((Position1 = EXEorig.find(sasho_621)) != std::string::npos)
		return 621;
	if ((Position1 = EXEorig.find(sasho_630)) != std::string::npos)
		return 630;
	if ((Position1 = EXEorig.find(sasho_640_641)) != std::string::npos && (Position2 = EXEorig.find(sasho_640)) != std::string::npos)
		return 640;
	if ((Position1 = EXEorig.find(sasho_640_641)) != std::string::npos && (Position2 = EXEorig.find(sasho_641)) != std::string::npos)
		return 641;
	if ((Position1 = EXEorig.find(sasho_642)) != std::string::npos)
		return 642;
	if ((Position1 = EXEorig.find(sasho_643)) != std::string::npos)
		return 643;
	if ((Position1 = EXEorig.find(sasho_650_651)) != std::string::npos && (Position2 = EXEorig.find(sasho_650)) != std::string::npos)
		return 650;
	if ((Position1 = EXEorig.find(sasho_650_651)) != std::string::npos && (Position2 = EXEorig.find(sasho_651)) != std::string::npos)
		return 651;
	if ((Position1 = EXEorig.find(sasho_660_661_662)) != std::string::npos && (Position2 = EXEorig.find(sasho_660)) != std::string::npos)
		return 660;
	if ((Position1 = EXEorig.find(sasho_660_661_662)) != std::string::npos && (Position2 = EXEorig.find(sasho_661_662)) != std::string::npos && (Position3 = EXEorig.find(sasho_661)) != std::string::npos)
		return 661;
	if ((Position1 = EXEorig.find(sasho_660_661_662)) != std::string::npos && (Position2 = EXEorig.find(sasho_661_662)) != std::string::npos && (Position3 = EXEorig.find(sasho_662)) != std::string::npos)
		return 662;	
	if ((Position1 = EXEorig.find(sasho_663)) != std::string::npos)
		return 663;
	if ((Position1 = EXEorig.find(sasho_664)) != std::string::npos)
		return 664;

	return -1;
}